<?xml version="1.0"?>

<BFSM>
		<!-- GOALS -->
		<!-- Left end of the Street -->
		<GoalSet id="0">
				<Goal capacity="1000000" id="0" max_x="-1.00" max_y="24.50" min_x="-40.00" min_y="20.50" type="AABB" weight="1.00"/>
				<Goal capacity="1000000" id="1" max_x="-1.00" max_y="15.50" min_x="-40.00" min_y="10.50" type="AABB" weight="1.00"/>
		</GoalSet>
		<!-- Right end of the street -->
		<GoalSet id="1">
			<Goal capacity="1000000" id="0" max_x="140.00" max_y="24.50" min_x="101.00" min_y="20.50" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="1" max_x="140.00" max_y="15.50" min_x="101.00" min_y="10.50" type="AABB" weight="1.00"/>
		</GoalSet>
		<!-- Windows -->
		<GoalSet id="2">
			<Goal capacity="1000000" id="0" max_x="6.38" max_y="24.77" min_x="2.26" min_y="23.98" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="2" max_x="17.47" max_y="24.87" min_x="14.97" min_y="24.10" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="3" max_x="27.52" max_y="24.82" min_x="23.98" min_y="24.27" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="4" max_x="39.48" max_y="24.82" min_x="37.00" min_y="24.22" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="5" max_x="55.02" max_y="24.82" min_x="45.04" min_y="24.25" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="6" max_x="65.86" max_y="24.87" min_x="62.32" min_y="24.22" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="7" max_x="73.62" max_y="24.85" min_x="71.19" min_y="24.22" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="8" max_x="83.60" max_y="24.82" min_x="79.27" min_y="24.27" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="9" max_x="98.22" max_y="24.82" min_x="90.97" min_y="24.29" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="10" max_x="99.06" max_y="10.92" min_x="94.64" min_y="10.12" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="11" max_x="85.00" max_y="10.74" min_x="80.36" min_y="10.12" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="12" max_x="72.94" max_y="10.57" min_x="70.15" min_y="10.02" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="13" max_x="62.56" max_y="10.65" min_x="56.35" min_y="10.11" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="14" max_x="47.89" max_y="10.65" min_x="43.40" min_y="10.16" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="15" max_x="34.27" max_y="10.56" min_x="29.18" min_y="10.16" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="16" max_x="23.84" max_y="10.59" min_x="20.29" min_y="10.16" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="17" max_x="12.80" max_y="10.65" min_x="11.17" min_y="10.13" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="18" max_x="5.28" max_y="10.79" min_x="1.02" min_y="10.22" type="AABB" weight="1.00"/>
		</GoalSet>
		<!-- Shops-->
		<GoalSet id="3">
			<Goal capacity="1000000" id="0" max_x="5.41" max_y="32.16" min_x="0.37" min_y="30.14" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="1" max_x="18.04" max_y="30.44" min_x="14.96" min_y="28.49" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="2" max_x="29.09" max_y="30.15" min_x="24.94" min_y="28.13" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="3" max_x="38.87" max_y="30.02" min_x="36.78" min_y="28.95" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="4" max_x="52.66" max_y="30.10" min_x="47.26" min_y="28.52" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="5" max_x="64.79" max_y="29.69" min_x="61.89" min_y="28.33" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="6" max_x="53.83" max_y="24.43" min_x="53.83" min_y="24.43" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="7" max_x="73.41" max_y="29.87" min_x="71.39" min_y="27.81" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="8" max_x="83.77" max_y="29.46" min_x="80.06" min_y="27.63" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="9" max_x="97.91" max_y="30.31" min_x="92.33" min_y="28.04" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="10" max_x="1.63" max_y="10.47" min_x="1.63" min_y="10.47" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="11" max_x="4.79" max_y="6.03" min_x="0.68" min_y="4.01" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="12" max_x="13.21" max_y="4.77" min_x="11.56" min_y="2.35" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="13" max_x="23.47" max_y="5.68" min_x="21.34" min_y="4.17" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="14" max_x="33.65" max_y="7.30" min_x="30.85" min_y="6.02" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="15" max_x="48.02" max_y="4.64" min_x="43.60" min_y="3.32" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="16" max_x="61.47" max_y="7.70" min_x="57.12" min_y="5.70" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="17" max_x="73.18" max_y="6.09" min_x="70.41" min_y="4.71" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="18" max_x="85.05" max_y="5.35" min_x="80.93" min_y="3.96" type="AABB" weight="1.00"/>
			<Goal capacity="1000000" id="19" max_x="98.91" max_y="5.96" min_x="95.68" min_y="4.13" type="AABB" weight="1.00"/>
    </GoalSet>
		<!-- Start of display and bench goals -->
		<!-- Start delete -->
		<GoalSet id="4">
			<Goal capacity="8" id="0" max_x="23.000000" min_x="19.000000" max_y="14.500000" min_y="14.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="1" max_x="24.000000" min_x="23.500000" max_y="19.000000" min_y="15.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="2" max_x="23.000000" min_x="19.000000" max_y="20.000000" min_y="19.500000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="3" max_x="18.500000" min_x="18.000000" max_y="19.000000" min_y="15.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="4" max_x="32.000000" min_x="28.000000" max_y="15.500000" min_y="15.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="5" max_x="33.000000" min_x="32.500000" max_y="20.000000" min_y="16.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="6" max_x="32.000000" min_x="28.000000" max_y="21.000000" min_y="20.500000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="7" max_x="27.500000" min_x="27.000000" max_y="20.000000" min_y="16.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="8" max_x="15.000000" min_x="11.000000" max_y="13.500000" min_y="13.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="9" max_x="16.000000" min_x="15.500000" max_y="18.000000" min_y="14.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="10" max_x="15.000000" min_x="11.000000" max_y="19.000000" min_y="18.500000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="11" max_x="10.500000" min_x="10.000000" max_y="18.000000" min_y="14.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="12" max_x="39.000000" min_x="35.000000" max_y="14.500000" min_y="14.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="13" max_x="40.000000" min_x="39.500000" max_y="19.000000" min_y="15.000000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="14" max_x="39.000000" min_x="35.000000" max_y="20.000000" min_y="19.500000" type="AABB" weight="1.00"/>
			<Goal capacity="8" id="15" max_x="34.500000" min_x="34.000000" max_y="19.000000" min_y="15.000000" type="AABB" weight="1.00"/>
		</GoalSet>
		<GoalSet id="5">
			<Goal capacity="1" id="0" type="point" weight="1.00" x="72.150000" y="17.500000"/>
			<Goal capacity="1" id="1" type="point" weight="1.00" x="72.850000" y="17.500000"/>
			<Goal capacity="1" id="2" type="point" weight="1.00" x="64.500000" y="15.150000"/>
			<Goal capacity="1" id="3" type="point" weight="1.00" x="64.500000" y="15.850000"/>
			<Goal capacity="1" id="4" type="point" weight="1.00" x="46.150000" y="18.500000"/>
			<Goal capacity="1" id="5" type="point" weight="1.00" x="46.850000" y="18.500000"/>
			<Goal capacity="1" id="6" type="point" weight="1.00" x="52.500000" y="15.150000"/>
			<Goal capacity="1" id="7" type="point" weight="1.00" x="52.500000" y="15.850000"/>
			<Goal capacity="1" id="8" type="point" weight="1.00" x="58.150000" y="19.500000"/>
			<Goal capacity="1" id="9" type="point" weight="1.00" x="58.850000" y="19.500000"/>
			<Goal capacity="1" id="10" type="point" weight="1.00" x="42.150000" y="18.500000"/>
			<Goal capacity="1" id="11" type="point" weight="1.00" x="42.850000" y="18.500000"/>
			<Goal capacity="1" id="12" type="point" weight="1.00" x="9.500000" y="15.150000"/>
			<Goal capacity="1" id="13" type="point" weight="1.00" x="9.500000" y="15.850000"/>
			<Goal capacity="1" id="14" type="point" weight="1.00" x="90.500000" y="17.150000"/>
			<Goal capacity="1" id="15" type="point" weight="1.00" x="90.500000" y="17.850000"/>
			<Goal capacity="1" id="16" type="point" weight="1.00" x="6.500000" y="19.150000"/>
			<Goal capacity="1" id="17" type="point" weight="1.00" x="6.500000" y="19.850000"/>
			<Goal capacity="1" id="18" type="point" weight="1.00" x="81.500000" y="16.150000"/>
			<Goal capacity="1" id="19" type="point" weight="1.00" x="81.500000" y="16.850000"/>
			<Goal capacity="1" id="20" type="point" weight="1.00" x="75.500000" y="19.150000"/>
			<Goal capacity="1" id="21" type="point" weight="1.00" x="75.500000" y="19.850000"/>
			<Goal capacity="1" id="22" type="point" weight="1.00" x="89.500000" y="14.150000"/>
			<Goal capacity="1" id="23" type="point" weight="1.00" x="89.500000" y="14.850000"/>
			<Goal capacity="1" id="24" type="point" weight="1.00" x="69.500000" y="15.150000"/>
			<Goal capacity="1" id="25" type="point" weight="1.00" x="69.500000" y="15.850000"/>
			<Goal capacity="1" id="26" type="point" weight="1.00" x="75.150000" y="14.500000"/>
			<Goal capacity="1" id="27" type="point" weight="1.00" x="75.850000" y="14.500000"/>
			<Goal capacity="1" id="28" type="point" weight="1.00" x="64.500000" y="19.150000"/>
			<Goal capacity="1" id="29" type="point" weight="1.00" x="64.500000" y="19.850000"/>
			<Goal capacity="1" id="30" type="point" weight="1.00" x="55.500000" y="18.150000"/>
			<Goal capacity="1" id="31" type="point" weight="1.00" x="55.500000" y="18.850000"/>
			<Goal capacity="1" id="32" type="point" weight="1.00" x="83.500000" y="16.150000"/>
			<Goal capacity="1" id="33" type="point" weight="1.00" x="83.500000" y="16.850000"/>
			<Goal capacity="1" id="34" type="point" weight="1.00" x="45.500000" y="16.150000"/>
			<Goal capacity="1" id="35" type="point" weight="1.00" x="45.500000" y="16.850000"/>
			<Goal capacity="1" id="36" type="point" weight="1.00" x="41.500000" y="16.150000"/>
			<Goal capacity="1" id="37" type="point" weight="1.00" x="41.500000" y="16.850000"/>
			<Goal capacity="1" id="38" type="point" weight="1.00" x="8.500000" y="19.150000"/>
			<Goal capacity="1" id="39" type="point" weight="1.00" x="8.500000" y="19.850000"/>
			<Goal capacity="1" id="40" type="point" weight="1.00" x="49.500000" y="15.150000"/>
			<Goal capacity="1" id="41" type="point" weight="1.00" x="49.500000" y="15.850000"/>
			<Goal capacity="1" id="42" type="point" weight="1.00" x="59.150000" y="16.500000"/>
			<Goal capacity="1" id="43" type="point" weight="1.00" x="59.850000" y="16.500000"/>
			<Goal capacity="1" id="44" type="point" weight="1.00" x="26.150000" y="13.500000"/>
			<Goal capacity="1" id="45" type="point" weight="1.00" x="26.850000" y="13.500000"/>
			<Goal capacity="1" id="46" type="point" weight="1.00" x="85.500000" y="19.150000"/>
			<Goal capacity="1" id="47" type="point" weight="1.00" x="85.500000" y="19.850000"/>
			<Goal capacity="1" id="48" type="point" weight="1.00" x="79.500000" y="14.150000"/>
			<Goal capacity="1" id="49" type="point" weight="1.00" x="79.500000" y="14.850000"/>
			<Goal capacity="1" id="50" type="point" weight="1.00" x="50.150000" y="18.500000"/>
			<Goal capacity="1" id="51" type="point" weight="1.00" x="50.850000" y="18.500000"/>
		</GoalSet>
		<!-- End delete -->
		<!-- End of display and bench goals -->
		<!-- BEHAVIOURS -->
		<State name="Start" final="0" >
			<GoalSelector type="identity"/>
			<VelComponent type="goal"/>
		</State>
		<State name="NotMovingStart" final="0">
			<GoalSelector type="identity"/>
			<VelComponent type="goal"/>
		</State>

		<!-- Agents choose a behaviour based on probability		 -->
		<Transition from="Start">
			<Condition type="auto"/>
			<Target type="prob">
				<State name="GoLeftSide" weight="1.25"/>
				<State name="GoRightSide" weight="1.25"/>
				<State name="WindowShopping" weight="0.8"/>
				<State name="GoToUnit" weight="0.1"/>
				<State name="GoToBench" weight="0.1"/>
			</Target>
		</Transition>

		<Transition from="NotMovingStart">
			<Condition type="auto"/>
			<Target type="prob">
				<State name="WindowShopping" weight="0.7"/>
				<State name="GoToUnit" weight="0.15"/>
				<State name="GoToBench" weight="0.15"/>
			</Target>
		</Transition>

		<State name ="GoLeftSide" final="0">
			<GoalSelector type="nearest" goal_set="0"/>
			<VelComponent type="road_map" file_name="graph.txt"/>
		</State>
		<State name="GoRightSide" final="0">
			<GoalSelector type="nearest" goal_set="1"/>
			<VelComponent type="road_map" file_name="graph.txt"/>
		</State>
		<State name="ReachedLeftSide" final="0">
			<GoalSelector type="identity"/>
			<VelComponent type="zero"/>
			<Action type="teleport" dist="u" min_x="99.0" max_x="99.9" min_y="10.5" max_y="24.5"/>
		</State>
		<State name="ReachedRightSide" final="0">
			<GoalSelector type="identity"/>
			<VelComponent type="zero"/>
			<Action type="teleport" dist="u" min_x="0.1" max_x="1.0" min_y="10.5" max_y="24.5"/>
		</State>

		<State name="WindowShopping" final="0">
			<GoalSelector type="random" goal_set="2"/>
			<VelComponent type="road_map" file_name="graph.txt"/>
			<Action type="scale_property" property="pref_speed" dist="c" value="0.75" exit_reset="1"/>
		</State>
		<State name="GoToUnit" final="0">
			<GoalSelector type="random" goal_set="4"/>
			<VelComponent type="road_map" file_name="graph.txt"/>
			<Action type="scale_property" property="pref_speed" dist="c" value="0.75" exit_reset="1"/>
		</State>
		<State name="GoToBench" final="0">
			<GoalSelector type="nearest" goal_set="5" per_agent="1" persistent="0"/>
			<VelComponent type="road_map" file_name="graph.txt"/>
			<Action type="scale_property" property="pref_speed" dist="c" value="0.75" exit_reset="1"/>
		</State>

		<State name="AtWindow" final="0">
			<GoalSelector type="identity"/>
			<VelComponent type="goal"/>
		</State>
		<State name="Like" final="0">
			<GoalSelector type="nearest" goal_set="3" per_agent="0"/>
			<VelComponent type="road_map" file_name="graph.txt"/>
		</State>
		<State name="InShop" final="0">
			<GoalSelector type="identity"/>
			<VelComponent type="goal"/>
		</State>

		<State name="AtDisplay" final="0">
			<GoalSelector type="identity"/>
			<VelComponent type="goal"/>
		</State>
		<State name="AtBench" final="0">
			<GoalSelector type="identity"/>
			<VelComponent type="goal"/>
		</State>

		<Transition from="GoLeftSide" to="ReachedLeftSide">
			<Condition type="AABB" min_x="-30.0" max_x="1.0" min_y="10.0" max_y="25.0" inside="1"/>
		</Transition>
		<Transition from="GoRightSide" to="ReachedRightSide">
			<Condition type="AABB" min_x="99.0" max_x="130.0" min_y="10.0" max_y="25.0" inside="1"/>
		</Transition>
		<Transition from="ReachedLeftSide">
			<Condition type="auto"/>
			<Target type="prob">
				<State name="GoLeftSide" weight="1"/>
				<State name="NotMovingStart" weight="0.6"/>
			</Target>
		</Transition>
		<Transition from="ReachedRightSide">
			<Condition type="auto"/>
			<Target type="prob">
				<State name="GoRightSide" weight="1"/>
				<State name="NotMovingStart" weight="0.6"/>
			</Target>

		</Transition>
		<Transition from="WindowShopping" to="AtWindow">
			<Condition type="goal_reached" distance="0.1"/>
		</Transition>
		<Transition from="AtWindow">
			<Condition type="timer" dist="u" min="3" max="7" seed="0" per_agent="1"/>
			<Target type="prob">
				<State name="Like" weight="5"/>
				<State name="WindowShopping" weight="0.7"/>
				<State name="GoLeftSide" weight="0.1"/>
				<State name="GoRightSide" weight="0.1"/>
				<State name="GoToUnit" weight="0.2"/>
				<State name="GoToBench" weight="0.2"/>
			</Target>
		</Transition>
		<Transition from="Like" to="InShop">
			<Condition type="goal_reached" distance="0.1"/>
		</Transition>
		<Transition from="InShop">
			<Condition type="timer" dist="u" min="10" max="30" seed="0" per_agent="1"/>
			<Target type="prob">
				<State name="WindowShopping" weight="0.7"/>
				<State name="GoLeftSide" weight="0.2"/>
				<State name="GoRightSide" weight="0.2"/>
				<State name="GoToUnit" weight="0.2"/>
				<State name="GoToBench" weight="0.2"/>
			</Target>
		</Transition>

		<!-- TODO: change the transitions from atunit, atbench so the agent doesn't go back to doing the same -->
		<Transition from="GoToUnit" to="AtDisplay">
			<Condition type="goal_reached" distance="0.1"/>
		</Transition>
		<Transition from="AtDisplay" to="Start">
			<Condition type="timer" dist="n" mean="10" stddev="2" per_agent="1" />
		</Transition>
		<Transition from="GoToBench" to="AtBench">
			<Condition type="goal_reached" distance="0.1"/>
		</Transition>
		<Transition from="AtBench" to="Start">
			<!-- TODO: Change this timer value back to something more realistic -->
			<Condition type="timer" dist="n" mean="30" stddev="5" per_agent="1" />
		</Transition>

</BFSM>
